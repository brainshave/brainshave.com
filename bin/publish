#!/bin/bash -e

if [ -n "$(git diff)" ]; then
  echo "Commit first"
  exit 1
fi

rm -rf dist
node_modules/.bin/broccoli build dist
git checkout gh-pages
ls | grep -vE "^(dist|CNAME|node_modules|favicon\.ico)$" | xargs rm -r

mv dist/* .
rmdir dist

git add -A .
git commit -m "Build."
git push origin gh-pages
git checkout master
